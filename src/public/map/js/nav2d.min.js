var NAV2D=NAV2D||{REVISION:"0.5.0-SNAPSHOT"};NAV2D.resizeMap=function(a,b,c){return a||(a={width:c.width,height:c.height,x:c.pose.position.x,y:c.pose.position.y},b.scaleToDimensions(c.width,c.height),b.shift(c.pose.position.x,c.pose.position.y)),(a.width!==c.width||a.height!==c.height)&&(b.scaleToDimensions(c.width,c.height),a.width=c.width,a.height=c.height),(a.x!==c.pose.position.x||a.y!==c.pose.position.y)&&(b.shift((c.pose.position.x-a.x)/1,(c.pose.position.y-a.y)/1),a.x=c.pose.position.x,a.y=c.pose.position.y),a},NAV2D.ImageMapClientNav=function(a){a=a||{};var b=a.ros,c=a.tfClient||null,d=a.topic||"/map_metadata",e=a.robot_pose||"/robot_pose",f=a.image_map,g=a.image||!1,h=a.serverName||"/move_base",i=a.actionName||"move_base_msgs/MoveBaseAction",j=a.rootObject||new createjs.Container,k=a.viewer,l=a.withOrientation||!1,m=null,n=new ROS2D.ImageMapClient({ros:b,rootObject:j,topic:d,image:f});new NAV2D.Navigator({ros:b,tfClient:c,serverName:h,actionName:i,robot_pose:e,rootObject:j,withOrientation:l,image:g});n.on("change",function(){m=NAV2D.resizeMap(m,k,n.currentGrid)})},NAV2D.Navigator=function(a){function b(a){var b=new ROSLIB.Goal({actionClient:k,goalMessage:{target_pose:{header:{frame_id:"/map"},pose:a}}});b.send(),c.currentGoal=b,null===c.goalMarker&&(j&&ROS2D.hasOwnProperty("ImageNavigator")?c.goalMarker=new ROS2D.ImageNavigator({size:2.5,image:j,alpha:.7,pulse:!0}):c.goalMarker=new ROS2D.NavigationArrow({size:15,strokeSize:1,fillColor:createjs.Graphics.getRGB(255,64,128,.66),pulse:!0}),c.rootObject.addChild(c.goalMarker)),c.goalMarker.x=a.position.x,c.goalMarker.y=-a.position.y,c.goalMarker.rotation=l.rosQuaternionToGlobalTheta(a.orientation),c.goalMarker.scaleX=1/l.scaleX,c.goalMarker.scaleY=1/l.scaleY,b.on("result",function(){c.rootObject.removeChild(c.goalMarker)})}var c=this;a=a||{};var d=a.ros,e=a.tfClient||null,f=a.robot_pose||"/robot_pose",g=a.serverName||"/move_base",h=a.actionName||"move_base_msgs/MoveBaseAction",i=a.withOrientation||!1,j=a.image;this.rootObject=a.rootObject||new createjs.Container,this.goalMarker=null;var k=new ROSLIB.ActionClient({ros:d,actionName:h,serverName:g});this.cancelGoal=function(){"undefined"!=typeof c.currentGoal&&c.currentGoal.cancel()};var l;l=c.rootObject instanceof createjs.Stage?c.rootObject:c.rootObject.getStage();var m=null;m=j&&ROS2D.hasOwnProperty("ImageNavigator")?new ROS2D.ImageNavigator({size:2.5,image:j,pulse:!0}):new ROS2D.NavigationArrow({size:25,strokeSize:1,fillColor:createjs.Graphics.getRGB(255,128,0,.66),pulse:!0}),m.visible=!1,this.rootObject.addChild(m);var n=!1,o=function(a,b){m.x=a.x,m.y=-a.y,n||(m.scaleX=1/l.scaleX,m.scaleY=1/l.scaleY,n=!0),m.rotation=l.rosQuaternionToGlobalTheta(b),m.visible=!0};if(null!==e)e.subscribe(f,function(a){o(a.translation,a.rotation)});else{var p=new ROSLIB.Topic({ros:d,name:f,messageType:"geometry_msgs/Pose",throttle_rate:100});p.subscribe(function(a){o(a.position,a.orientation)})}if(i===!1)this.rootObject.addEventListener("dblclick",function(a){var c=l.globalToRos(a.stageX,a.stageY),d=new ROSLIB.Pose({position:new ROSLIB.Vector3(c)});b(d)});else{var q=null,r=null,s=0,t=0,u=null,v=!1,w=0,x=0,y=function(a,d){if("down"===d)q=l.globalToRos(a.stageX,a.stageY),r=new ROSLIB.Vector3(q),v=!0;else if("move"===d){if(c.rootObject.removeChild(u),v===!0){var e=l.globalToRos(a.stageX,a.stageY),f=new ROSLIB.Vector3(e);u=j&&ROS2D.hasOwnProperty("ImageNavigator")?new ROS2D.ImageNavigator({size:2.5,image:j,alpha:.7,pulse:!1}):new ROS2D.NavigationArrow({size:25,strokeSize:1,fillColor:createjs.Graphics.getRGB(0,255,0,.66),pulse:!1}),w=f.x-r.x,x=f.y-r.y,s=Math.atan2(w,x),t=s*(180/Math.PI),t>=0&&180>=t?t+=270:t-=90,u.x=r.x,u.y=-r.y,u.rotation=t,u.scaleX=1/l.scaleX,u.scaleY=1/l.scaleY,c.rootObject.addChild(u)}}else if(v){v=!1;var g=l.globalToRos(a.stageX,a.stageY),h=new ROSLIB.Vector3(g);w=h.x-r.x,x=h.y-r.y,s=Math.atan2(w,x),s>=0&&s<=Math.PI?s+=3*Math.PI/2:s-=Math.PI/2;var i=Math.sin(-s/2),k=Math.cos(-s/2),m=new ROSLIB.Quaternion({x:0,y:0,z:i,w:k}),n=new ROSLIB.Pose({position:r,orientation:m});b(n)}};this.rootObject.addEventListener("stagemousedown",function(a){y(a,"down")}),this.rootObject.addEventListener("stagemousemove",function(a){y(a,"move")}),this.rootObject.addEventListener("stagemouseup",function(a){y(a,"up")})}},NAV2D.OccupancyGridClientNav=function(a){a=a||{};var b=a.ros,c=a.tfClient||null,d=a.topic||"/map",e=a.robot_pose||"/robot_pose",f=a.continuous,g=a.serverName||"/move_base",h=a.actionName||"move_base_msgs/MoveBaseAction",i=a.rootObject||new createjs.Container,j=a.viewer,k=a.withOrientation||!1,l=a.image||!1,m=null,n=new ROS2D.OccupancyGridClient({ros:b,rootObject:i,continuous:f,topic:d});new NAV2D.Navigator({ros:b,tfClient:c,serverName:g,actionName:h,robot_pose:e,rootObject:i,withOrientation:k,image:l});n.on("change",function(){m=NAV2D.resizeMap(m,j,n.currentGrid)})};